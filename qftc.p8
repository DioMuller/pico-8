pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- params
p_current_health=6
p_max_health=6

p_pos_x=4
p_pos_y=4

p_cam_x=0
p_cam_y=0

p_spr=1
p_flip_x=false
p_flip_y=false

p_attacking=false
p_walking=false
p_anim_frames=0

-- directions:
-- 0 = left
--	1 = right
-- 2 = up
-- 3 = down
p_direction=0

-- helper functions
function update_player_spr()
	if p_direction == 0 then
		
		if p_walking then
			if p_anim_frames < 3 then
				p_spr=18
			else
				p_spr=34
			end
		else
			p_spr=2
		end
		
		p_flip_x=true
		p_flip_y=false
	elseif p_direction == 1 then
				
		if p_walking then
						if p_anim_frames < 3 then
				p_spr=18
			else
				p_spr=34
			end
		else
			p_spr=2
		end
		
		p_flip_x=false
		p_flip_y=false
	elseif p_direction == 2 then
				
		if p_walking then
			if p_anim_frames < 3 then
				p_spr=17
			else
				p_spr=33
			end
		else
			p_spr=1
		end
		
		p_flip_x=false
		p_flip_y=true
	else
						
		if p_walking then
			if p_anim_frames < 3 then
				p_spr=17
			else
				p_spr=33
			end
		else
			p_spr=1
		end
		
		p_flip_x=false
		p_flip_y=false
	end
end

function can_move(x,y)
	return not fget(mget(p_cam_x + x,p_cam_y + y),0)
end

-- main game loop
function _init()

end

function _update()
	
	local mov_x = 0
	local mov_y = 0
	
	if p_anim_frames > 0 then
		p_anim_frames-=1
	else
		p_walking = false
		p_attacking = true
	end
	-- player movement	
	if btnp(0) then
		if p_direction == 0 then
			mov_x -= 1
			p_walking = true
			p_anim_frames = 4
		else
			p_direction = 0
		end
	elseif btnp(1) then
		if p_direction == 1 then
			mov_x += 1
			p_walking = true
			p_anim_frames = 4
		else
			p_direction = 1
		end
	elseif btnp(2) then
		if p_direction == 2 then
			mov_y -= 1
			p_walking = true
			p_anim_frames = 4
		else
			p_direction = 2
		end
	elseif btnp(3) then
		if p_direction == 3 then
			mov_y += 1
			p_walking = true
			p_anim_frames = 4
		else
			p_direction = 3
		end
	end
	
	-- update position
	if can_move(p_pos_x + mov_x, p_pos_y + mov_y) then
		p_pos_x += mov_x
		p_pos_y += mov_y
	end
	
	-- update map
	if p_pos_x >= 16 then
		p_pos_x -= 16
		p_cam_x += 16
	elseif p_pos_x < 0 then
		p_pos_x += 16
		p_cam_x -= 16
	end
	
	if p_pos_y >= 12 then
		p_pos_y -= 12
		p_cam_y += 12
	elseif p_pos_y < 0 then
		p_pos_y += 12
		p_cam_y -= 12
	end
	
	-- update player sprite
	update_player_spr()
	
end

function _draw()
	-- draw map
	map(p_cam_x,p_cam_y,0,16,16,12)
	
	-- draw character
	spr(p_spr,p_pos_x*8, p_pos_y*8+16, 1, 1, p_flip_x, p_flip_y)
	
	-- draw ui
	rectfill(0,0,128,16,1)
	local drawn_health=0
	local position=0
	
	while drawn_health < p_max_health do
		local to_draw = p_current_health - drawn_health
		
		if to_draw <= 0 then
			spr(16,position,0)
		elseif to_draw == 1 then
			spr(32,position,0)
		else
			spr(48,position,0)
		end
		
		drawn_health += 2
		position += 8
	end
	
	rectfill(0,112,128,128,1)
end
__gfx__
00000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000055000055500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700059999500099f00006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000599995000999f0006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000f99f0000999f0006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000ff0000099f00006000000050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000055000006000000556666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00055000000000000000000044000044400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00500500000004400455000000400400400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05000050059999500499f00000044000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
500000050599995000999f0000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5000000504f99f0000999f0000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05000050000ff0000099f00000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00500500000000000055400000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00055000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00055000000000000000000000202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00580500044000000055400000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05880050059999500099f00000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
588800050599995000999f0000040000200006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5888000500f99f4000999f0000040000024446600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05880050000ff0000499f00000666000200006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00580500000000000455000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00588500000000000055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05888850059999500099f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
588888850599995000999f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5888888505f99f0000999f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05888850050ff0000099f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
005885000f000000005555f400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00055000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbaaaaaaaaa7a7a7a7cccccccc665555555555555555555566000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbaaaaaaaa77777777cccccccc656666666666666666666656000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbaaaaaaaac7c7c7c7cccccccc566666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbaaaaaaaa7c7c7c7ccccccccc566666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbaaaaaaaacccccccccccccccc566666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbaaaaaaaacccccccccccccccc566666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbaaaaaaaacccccccccccccccc566666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbaaaaaaaacccccccccccccccc566666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000
b4bbb44b555555555565555566666666566666666555555666666665000000000000000000000000000000000000000000000000000000000000000000000000
bb4b4bbb5555555a5565555566666666566666665111111566666665000000000000000000000000000000000000000000000000000000000000000000000000
44b4bb4b555555555565555566666666566666665111111566666665000000000000000000000000000000000000000000000000000000000000000000000000
bb4bb4bb5555555a6666666666666666566666665111111566666665000000000000000000000000000000000000000000000000000000000000000000000000
bb4b4b4b555555555555565566666666566666665111111566666665000000000000000000000000000000000000000000000000000000000000000000000000
bbb44bbb5555555a555556556666666656666666511dd11566666665000000000000000000000000000000000000000000000000000000000000000000000000
bbb44bbb5555555555555655666666665666666651dddd1566666665000000000000000000000000000000000000000000000000000000000000000000000000
bb4444bb5555555a6666666666666666566666665dddddd566666665000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
15141414141414141414141414141425000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
24242424242424242424242424242424000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
34343434343434343434343434343434000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
34343434343434343434343434343434000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010101000000000000000000010101000100010000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
5050505050505050505050505050505050505050505050505050505050505052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040404040404040404040404040404040404052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040404040404040404040404040404040404052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040404040404040404040404040404040404052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040404040404040404040404040404040404052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040404040404040404040404040404040404052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040404040404040404040404040404040404052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040404040404040404040404040404040404052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040404040404040404040404040404040404052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040404040404040404040404040404040404052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040404040404040404040404040404040404052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040405252525252525252525252525252525252000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040405200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040405200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040405200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040405200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040405200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040405200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040405200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040405200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040405200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040405200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040405200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5040404040404040404040404040405200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5141414141414141414141414141415200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5141414141414141414141414141415200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5141414141414141414141414141415200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5141414141414141414141414141415200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5141414141414445464141414141415200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5141414141415455564141414141415200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5141414141414141414141414141415200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5141414141414141414141414141415200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000000650006500065000650016500365004650096500c6501165014650186501e650256502d65033650346502e650226501b65015650116500f6500d6500b6500a650096500865007650066500565004650
